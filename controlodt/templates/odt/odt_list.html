{% extends 'base.html' %}
{% block content %}
<section class="text-neutral-900">
  <div class="mx-auto px-4 py-6">

    <div class="flex flex-wrap items-center justify-between gap-4 mb-6">

  <!-- Título -->
  <div class="min-w-[220px]">
    <h1 class="text-2xl md:text-3xl font-primary">{{ title }}</h1>
    <p class="text-neutral-500 text-sm">Gestión de órdenes de trabajo</p>
  </div>
   <!-- Botón Nueva -->
  {% comment %} <a href="{% url 'odt_create' %}"
     class="h-11 px-5 py-2 rounded-xl bg-green-600 text-white font-semibold hover:opacity-90">
    Nueva ODT
  </a> {% endcomment %}


  <!-- FILTROS -->
  <form method="get"
        class="w-auto grid grid-cols-1 xl:grid-cols-5 gap-3">

    <select name="tipo" class="h-10 px-3 w-full  border border-neutral-200 bg-neutral-100 rounded-lg">
      <option value="">-- Linea --</option>
      {% for t in tipos %}
        <option value="{{ t.id }}" {% if request.GET.tipo == t.id|stringformat:"s" %}selected{% endif %}>
          {{ t.nombre }}
        </option>
      {% endfor %}
    </select>

    <select name="maquinaria" class="h-10 px-3 w-full border border-neutral-200 bg-neutral-100 rounded-lg">
      <option value="">-- Equipo --</option>
      {% for m in maquinarias %}
        <option value="{{ m.id }}" {% if request.GET.maquinaria == m.id|stringformat:"s" %}selected{% endif %}>
          {{ m.nombre }}
        </option>
      {% endfor %}
    </select>

    <select name="prioridad" class="h-10 px-3 w-full border border-neutral-200 bg-neutral-100 rounded-lg">
      <option value="">-- Prioridad --</option>
      {% for value,label in prioridades %}
        <option value="{{ value }}" {% if request.GET.prioridad == value %}selected{% endif %}>
          {{ label }}
        </option>
      {% endfor %}
    </select>

    <div class="col-span-2 xl:col-span-2 flex flex-wrap gap-3">
      <button class="px-5 h-10 rounded-lg bg-blue-600 text-white">Filtrar</button>
      <a href="{% url 'odt_list' %}"
         class="px-5 h-10  py-2 rounded-lg bg-neutral-300">
        Limpiar
      </a>
    </div>
  </form>

 
</div>


    <div class="overflow-x-auto">
      <table class="min-w-full bg-neutral-100 border border-neutral-200 rounded-xl overflow-hidden">
        <thead class="bg-slate-900 text-neutral-100">
          <tr class="text-left text-sm">
            <th class="px-4 py-3">N° ODT</th>
            <th class="px-4 py-3">Fecha</th>
            <th class="px-4 py-3">Falla Reportada</th>
            <th class="px-4 py-3">Linea</th>
            <th class="px-4 py-3">Prioridad</th>
            <th class="px-4 py-3">Equipo/Parte</th>
            <th class="px-4 py-3">Solicitado Por</th>
            <th class="px-4 py-3">Entregado A</th>
            <th class="px-4 py-3">Estado</th>
            <th class="px-4 py-3 text-center">Acciones</th>
          </tr>
        </thead>

        <tbody class="divide-y divide-neutral-50">
          {% for odt in odts %}
          <tr class="hover:bg-neutral-200 text-sm">
            <td class="px-4 py-3 font-semibold">{{ odt.n_odt|stringformat:"03d" }}</td>
            <td class="px-4 py-3">{{ odt.creado_en|date:"d/m/Y" }}</td>
            <td class="px-4 py-3">{{ odt.titulo }}</td>
            <td class="px-4 py-3">{{ odt.tipo.nombre }}</td>
            <td class="px-4 py-3 whitespace-nowrap">
              {% if odt.prioridad == 'URGENTE' %}
                <span class="px-2 py-1 text-xs font-bold text-red-700">⚠️ URGENTE</span>
              {% elif odt.prioridad == 'ALTA' %}
                <span class="px-2 py-1 text-xs font-semibold text-orange-700">ALTA</span>
              {% elif odt.prioridad == 'MEDIA' %}
                <span class="px-2 py-1 text-xs text-yellow-700">MEDIA</span>
              {% else %}
                <span class="px-2 py-1 text-xs text-neutral-600">BAJA</span>
              {% endif %}
            </td>
            <td class="px-4 py-3">{{ odt.maquinaria.nombre }}</td>
            
            <td class="px-4 py-3">{{ odt.creado_por.get_full_name }}</td>
            <td class="px-4 py-3">
              {{ odt.responsable_ejecucion.get_full_name|default:"—" }}
            </td>
            
            <td class="px-4 py-3 whitespace-nowrap">
              {% if odt.estado == 'BORRADOR' %}
                <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-700 border border-gray-300">
                  Borrador
                </span>
              {% elif odt.estado == 'SOLICITUD' %}
                <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-blue-50 text-blue-700 border border-blue-200">
                  En Solicitud
                </span>
              {% elif odt.estado == 'ASIGNADA' %}
                <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-purple-50 text-purple-700 border border-purple-200">
                  Asignada
                </span>
              {% elif odt.estado == 'EN_EJECUCION' %}
                <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-yellow-50 text-yellow-700 border border-yellow-200">
                  En Ejecución
                </span>
              {% elif odt.estado == 'REVISION' %}
                <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-orange-50 text-orange-700 border border-orange-200">
                  En Revisión
                </span>
              {% elif odt.estado == 'APROBADA' %}
                <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-green-50 text-green-700 border border-green-200">
                  Aprobada
                </span>
              {% elif odt.estado == 'CERRADA' %}
                <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-slate-100 text-slate-700 border border-slate-300">
                  Cerrada
                </span>
              {% elif odt.estado == 'RECHAZADA' %}
                <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-red-50 text-red-700 border border-red-200">
                  Rechazada
                </span>
              {% endif %}
            </td>
            <td class="px-4 py-3">
              <div class="flex items-center justify-end gap-2">
                <a href="{% url 'odt_detail' odt.pk %}"
                   class="inline-flex items-center whitespace-nowrap h-9 px-3 rounded-lg bg-blue-500 text-white hover:bg-blue-600 text-sm">
                  Ver Proceso
                </a>
               
              </div>
            </td>
          </tr>

          {% empty %}
          <tr>
            <td colspan="7" class="px-4 py-8 text-center text-neutral-500">
              No hay ODTs registradas.
            </td>
          </tr>
          {% endfor %}
        </tbody>

      </table>
      {% if page_obj.has_other_pages %}
<div class="flex justify-center mt-6 gap-2">

  {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}" class="px-3 py-1 border rounded-lg">Anterior</a>
  {% endif %}

  <span class="px-4 py-1 font-semibold">
    Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
  </span>

  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}" class="px-3 py-1 border rounded-lg">Siguiente</a>
  {% endif %}

</div>
{% endif %}

    </div>

  </div>
</section>
{% endblock %}