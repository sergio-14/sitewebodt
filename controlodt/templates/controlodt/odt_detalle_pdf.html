{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Orden de Trabajo</title>


  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; font-size: 10pt; color: #1f2937; line-height: 1.4; }
    .container { padding: 16px 20px; max-width: 800px; margin: 0 auto; }

    .header-table { width: 100%; border: none; margin-bottom: 6px; }
    .logo-img { width: 90pt; height: auto; }
    .company-title { font-size: 16pt; font-weight: bold; color: #3d4f2a; }
    .company-subtitle { font-size: 9pt; color: #374151; margin-top: 2pt; }
    .doc-title { font-size: 11pt; font-weight: bold; color: #111827; margin-top: 4pt; }
    .divider-double { height: 4pt; margin-top: 6pt; }
    .divider-double div { border-bottom: 1pt solid #111827; margin-bottom: 1pt; }

    .meta-info { font-size: 9pt; color: #374151; text-align: right; padding: 8pt 0; }

    .section { margin: 12px 0; }
    .section-header { background-color: #3d4f2a; color: white; padding:8px 12px; border-radius:4px; }

    .info-card { background:#f9fafb; border:1px solid #e5e7eb; padding:2px 1px; margin-bottom:2px; }
    .data-grid td { padding:1px 0; vertical-align: top; border:none; font-size:10pt; }
    .data-label { color:#6b7280; }
    .data-value { color:#111827; font-weight:600; margin-left:6px; }

    .styled-table { width:100%; border-collapse:collapse; font-size:9pt; margin:10px 0; }
    .styled-table th { background:#1CB841; color:white; padding:6px 6px; text-align:left; font-weight:bold; }
    .styled-table td { padding:3px 6px; border:1px solid #e5e7eb; }

    .badge { display:inline-block; padding:4px 10px; border-radius:12px; font-size:8pt; color:white; font-weight:bold; text-transform:uppercase; }
    .badge-green { background:#16a34a; } .badge-red { background:#dc2626; } .badge-amber { background:#d97706; } .badge-gray { background:#6b7280; }

    .financial-summary {  padding:2px; margin:10px 0; }
    .financial-row { display:table; width:100%; margin:4px 0; }
    .financial-row  div { display:table-cell; padding:4px 8px; }
    .financial-label { width:60%; font-weight:bold; color:#374151; }
    .financial-value { width:40%; text-align:right; font-weight:bold; color:#111827; font-size:11pt; }

    /* utilidades de salto de página */
    .record-block { page-break-inside: avoid; }
    .page-break-before { page-break-before: always; }
  </style>
</head>
<body>
  <div class="container">

        <!-- HEADER para este registro (se repite por cada venta porque está dentro del loop) -->
        <table class="header-table">
          <tr>
            <td style="width:100pt; vertical-align: middle;">
              <img src="{% static 'src/img/logo.png' %}" alt="Logo" class="logo-img" />
              
            </td>
            <td style="vertical-align: middle; text-align: center;">
              <div class="company-title">EMBOTELLADORA NUDELPA LIMITADA</div>
              <div class="company-subtitle">Trinidad - Beni - Bolivia</div>
              <div class="doc-title">Orden de Trabajo</div>
              <div class="divider-double"><div></div><div></div></div>
            </td>
            <td style="width:50pt; vertical-align: middle;">
              <img src="{% static 'src/img/logoc.jpg' %}" alt="Logo" class="logo-img" />
              
            </td>
            
          </tr>
        </table>

        <div class="meta-info">
          <strong>Santísima Trinidad,</strong> {% now "j" %} de {% now "F" %} de {% now "Y" %} - <strong>Nudelpa/{{ odt.correlativo|stringformat:"03d" }}
        </div>
       
        <br/>

        <!-- INFORMACIÓN PERSONAL (inyectada en cada registro para que aparezca con cada encabezado) -->
        <div class="section record-block">
          <td style="width:55%; vertical-align:middle;">
            <div style="font-weight:bold; font-size:12pt;">Información</div>
          </td>
          <div class="info-card">
            <table class="data-grid " style="border: none; margin-bottom: 12px;">
              <tr>
                <td>
                  <span class="data-label">Fecha Emitida:</span>
                  <span class="data-value">{{ odt.fecha_programada|date:"d/m/Y H:i"|default:"—" }}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="data-value">Numero ODT: {{ odt.n_odt|stringformat:"03d" }}</span>
                </td>
              </tr>
              <tr>
                <td>
                  <span class="data-label">Prioridad:</span>
                  <span class="data-value"> {{ odt.get_prioridad_display }}</span>
                </td>
                <td style="text-align: right;">
                  <span class="data-label">Estado:</span>
                  <span class="data-value">{{ odt.get_estado_display }}</span>
                </td>
              </tr>
              <tr>
                <td colspan="2">
                  <span class="data-label">Referencia o Razon:</span>
                  <span class="data-value">{{ odt.titulo }}</span>
                </td>
              </tr>
              
            </table>
           
          </div>
        </div>
        <div class="section record-block">
          <td style="width:55%; vertical-align:middle;">
            <div style="font-weight:bold; font-size:12pt;">Datos del Equipo</div>
          </td>
          <div class="info-card">
            <table class="data-grid " style="border: none; ">
              <tr>
                <td>
                  <span class="data-label">Línea:</span>
                  <span class="data-value">{{ odt.maquinaria.tipo.nombre }}</span>
                </td>
              </tr>
              <tr>
                <td>
                  <span class="data-label">Equipo:</span>
                  <span class="data-value">{{ odt.maquinaria.nombre }}</span>
                </td>
                <td colspan="2" style="text-align: right;">
                  <span class="data-label">Codigo:</span>
                  <span class="data-value">{{ odt.maquinaria.codigo }}</span>
                </td>
              </tr>
              <tr>
                <td>
                  <span class="data-label">Parte de Equipo:</span>
                  <span class="data-value">{{ odt.parte_equipo }}</span>
                </td>
                <td colspan="2" style="text-align: right;">
                  <span class="data-label">Estado:</span>
                  <span class="data-value">{{ odt.maquinaria.get_estado_display }}</span>
                </td>
              </tr>
              
              
              
            </table>
            <table class=" " style="border: none; ">
              
              <tr>
                <td>
                  <span class="data-label">Referencia o Razon:</span>
                  <span class="data-value">{{ odt.titulo }}</span>
                </td>
               
              </tr>
              
              
            </table>
            <p style="font-size: 10pt; background: white; border: none;">Descrión del Fallo: {{ odt.descripcion }}</p>
        
          </div>
        </div>
       
    <h2 style="margin-top: 25px; margin-bottom: 10px;">Personal Involucrado y Firmas</h2>
    
    <br>
    <table class="firma-table" style="text-align: center;">
        <tr>
            <!-- COLUMNA 1: REALIZADO POR -->
            <td>
                
                {% if odt.creado_por %}
                    {% if odt.creado_por.firma %}
                        <img class="firma-img" src="{{ odt.creado_por.firma.url }}" style="width: auto; height: 50pt;" alt="Firma">
                    {% else %}
                        <p class="no-firma">Firma no registrada</p>
                    {% endif %}
                    <h4 style="font-size: 8pt;">Realizado por {% for g in odt.creado_por.groups.all %}{{ g.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</h4>
                    <p style="font-size: 9pt;" class="firma-name">{{ odt.creado_por.get_full_name }}</p>
                   
                {% else %}
                    <p class="no-firma">No asignado</p>
                {% endif %}
            </td>
            
            <!-- COLUMNA 2: REVISADO POR -->
            <td>
                
                {% if odt.revisado_por %}
                    {% if odt.revisado_por.firma %}
                        <img class="firma-img" src="{{ odt.revisado_por.firma.url }}" style="width: auto; height: 50pt;" alt="Firma">
                    {% else %}
                        <p class="no-firma">Firma no registrada</p>
                    {% endif %}
                    <h4 style="font-size: 8pt;">Revisado por {% for g in odt.revisado_por.groups.all %}{{ g.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</h4>
                    <p style="font-size: 9pt;" class="firma-name">{{ odt.revisado_por.get_full_name }}</p>
                    
                    
                {% else %}
                    <p class="no-firma">Pendiente de revisión</p>
                {% endif %}
            </td>
            
            <!-- COLUMNA 3: APROBADO POR -->
            <td>
                
                {% if odt.aprobado_por %}
                    {% if odt.aprobado_por.firma %}
                        <img class="firma-img" src="{{ odt.aprobado_por.firma.url }}" style="width: auto; height: 50pt;" alt="Firma">
                    {% else %}
                        <p class="no-firma">Firma no registrada</p>
                    {% endif %}
                    <h4 style="font-size: 8pt;">Aprobado por {% for g in odt.aprobado_por.groups.all %}{{ g.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</h4>
                    <p style="font-size: 9pt;" class="firma-name">{{ odt.aprobado_por.get_full_name }}</p>
                   
                {% else %}
                    <p class="no-firma">Pendiente de aprobación</p>
                {% endif %}
            </td>
        </tr>
    </table>
    
</body>
</html>