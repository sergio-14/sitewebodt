{% extends 'base.html' %}
{% block content %}
<section class="text-neutral-900">
  <div class="max-w-auto mx-auto px-2 py-6">
    <div class=" flex flex-col gap-3
              md:flex-row  items-center justify-between mb-6">
      <div>
        <h1 class="text-2xl font-primary">Órdenes de Trabajo (ODT)</h1>
        <p class="text-sm text-neutral-500">Total: {{ total }}</p>
      </div>
      <div>
        <a href="{% url 'odt_create' %}" class="h-11 px-5 py-2 rounded-md bg-green-500 text-white">+ Crear Nueva ODT</a>
      </div>
    </div>

    <form method="get" class="mb-4">
  <div class="flex flex-col gap-3
              md:flex-row md:items-end">

    <input
      name="q"
      placeholder="Buscar por título, maquinaria o código"
      value="{{ q }}"
      class="w-full h-11 rounded-md border bg-neutral-100 border-neutral-300 px-3"
    />

    <select
      name="estado"
      class="w-full md:w-auto h-11 rounded-md border bg-neutral-100 border-neutral-300 px-3"
    >
      <option value="">Todos</option>
      <option value="BORRADOR" {% if estado_selected == 'BORRADOR' %}selected{% endif %}>Borrador</option>
      <option value="ASIGNADA" {% if estado_selected == 'ASIGNADA' %}selected{% endif %}>Asignada</option>
      <option value="EN_EJECUCION" {% if estado_selected == 'EN_EJECUCION' %}selected{% endif %}>En ejecución</option>
      <option value="REVISION" {% if estado_selected == 'REVISION' %}selected{% endif %}>Revisión</option>
      <option value="APROBADA" {% if estado_selected == 'APROBADA' %}selected{% endif %}>Aprobada</option>
      <option value="RECHAZADA" {% if estado_selected == 'RECHAZADA' %}selected{% endif %}>Rechazada</option>
      <option value="CERRADA" {% if estado_selected == 'CERRADA' %}selected{% endif %}>Cerrada</option>
    </select>

    <select
      name="prioridad"
      class="w-full md:w-auto h-11 rounded-md border bg-neutral-100 border-neutral-300 px-3"
    >
      <option value="">Todas prioridades</option>
      <option value="BAJA" {% if prioridad_selected == 'BAJA' %}selected{% endif %}>Baja</option>
      <option value="MEDIA" {% if prioridad_selected == 'MEDIA' %}selected{% endif %}>Media</option>
      <option value="ALTA" {% if prioridad_selected == 'ALTA' %}selected{% endif %}>Alta</option>
      <option value="URGENTE" {% if prioridad_selected == 'URGENTE' %}selected{% endif %}>Urgente</option>
    </select>

    <select
      name="per_page"
      class="w-full md:w-auto h-11 rounded-md border bg-neutral-100 border-neutral-300 px-3"
    >
      {% for n in per_page_options %}
        <option value="{{ n }}" {% if per_page == n %}selected{% endif %}>{{ n }}</option>
      {% endfor %}
    </select>

    <button
      class="w-full md:w-auto h-11 px-4 rounded-md bg-amber-500 text-white"
    >
      Filtrar
    </button>

  </div>
</form>


    <div class="mt-2 overflow-x-auto">
      <table class="min-w-full border border-neutral-200 bg-neutral-100 rounded-md overflow-hidden">
        <thead class="bg-slate-900 text-white">
          <tr class="text-left text-xs">
            <th class="px-4 py-3">N°</th>
            <th class="px-4 py-3">N° ODT</th>
            <th class="px-4 py-3">Línea y Equipo</th>
            
            <th class="px-4 py-3">Parte de equipo</th>
            <th class="px-4 py-3">Referencia</th>
            <th class="px-4 py-3">Prioridad</th>
            <th class="px-4 py-3">Estado</th>
            
            <th class="px-4 py-3 text-right">Acciones</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-neutral-50">
          {% for odt in page_obj.object_list %}
          <tr class="hover:bg-neutral-200 text-xs">
            <td class="px-4 py-3">{{ forloop.counter0|add:page_obj.start_index }}</td>
            <td class="px-4 py-3 font-semibold">
              {{ odt.n_odt|stringformat:"03d" }}
            </td>
            <td class="px-4 py-3 whitespace-nowrap">
              <div>{{ odt.maquinaria.tipo }}</div>
              <div>{{ odt.maquinaria }}</div>
            </td>
            <td class="px-4 py-3 whitespace-nowrap">{{ odt.parte_equipo }}</td>
            <td class="px-4 py-3">{{ odt.titulo }}</td>
            <td class="px-4 py-3">{{ odt.get_prioridad_display }}</td>
            <td class="px-4 py-3 whitespace-nowrap">
              <span class="px-2 py-1 rounded-full text-xs bg-green-50 text-green-700 border border-green-200">
                {{ odt.get_estado_display }}
              </span>
            </td>
            <td class="px-4 py-3 text-right whitespace-nowrap">
              {% comment %} <a href="{% url 'odt_edit' odt.pk %}?next={{ request.get_full_path|urlencode }}" class="inline-flex items-center h-9 px-3 rounded-lg bg-amber-300 text-white">
                <svg class="md:size-5 size-4  text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m14.304 4.844 2.852 2.852M7 7H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-4.5m2.409-9.91a2.017 2.017 0 0 1 0 2.853l-6.844 6.844L8 14l.713-3.565 6.844-6.844a2.015 2.015 0 0 1 2.852 0Z"/>
                  </svg>
              </a> {% endcomment %}
              <a href="{% url 'odt_detail' odt.pk %}" class=" inline-flex items-center h-9 px-3 rounded-lg bg-amber-400 text-white">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="me-1 bi bi-eye" viewBox="0 0 16 16">
                  <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
                  <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
                </svg>
                Detalle
              </a>
              <a href="{% url 'odt_detalle_pdf' odt.pk %}" target="_black" class="inline-flex items-center h-9 px-3 rounded-lg bg-teal-600 text-white ml-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-filetype-pdf me-1" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM1.6 11.85H0v3.999h.791v-1.342h.803q.43 0 .732-.173.305-.175.463-.474a1.4 1.4 0 0 0 .161-.677q0-.375-.158-.677a1.2 1.2 0 0 0-.46-.477q-.3-.18-.732-.179m.545 1.333a.8.8 0 0 1-.085.38.57.57 0 0 1-.238.241.8.8 0 0 1-.375.082H.788V12.48h.66q.327 0 .512.181.185.183.185.522m1.217-1.333v3.999h1.46q.602 0 .998-.237a1.45 1.45 0 0 0 .595-.689q.196-.45.196-1.084 0-.63-.196-1.075a1.43 1.43 0 0 0-.589-.68q-.396-.234-1.005-.234zm.791.645h.563q.371 0 .609.152a.9.9 0 0 1 .354.454q.118.302.118.753a2.3 2.3 0 0 1-.068.592 1.1 1.1 0 0 1-.196.422.8.8 0 0 1-.334.252 1.3 1.3 0 0 1-.483.082h-.563zm3.743 1.763v1.591h-.79V11.85h2.548v.653H7.896v1.117h1.606v.638z"/>
                </svg>
                Imprimir</a>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="7" class="px-4 py-8 text-center text-neutral-500">No hay ODTs.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if page_obj.paginator.num_pages > 1 %}
      <div class="mt-4">
        <!-- Reusa tu paginación -->
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}
